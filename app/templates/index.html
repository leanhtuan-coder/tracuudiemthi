<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang tra cứu điểm thi THPTQG 2024</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <header class="navbar">
        <a href="#tra-cuu">Trang tra cứu điểm thi THPTQG 2024</a>
    </header>
    <div id="tra-cuu" class="container">
        <h2>Tra cứu điểm thi</h2>
        <form id="searchForm" class="search">
            <input type="text" id="soBaoDanh" class="search__input" placeholder="Nhập số báo danh">
            <select id="province" class="search__input">
                <option value="0">Chọn tỉnh/thành phố</option>
                <option value="1">Hà Nội</option>
                <option value="2">Hà Giang</option>
                <option value="4">Cao Bằng</option>
                <option value="6">Bắc Kạn</option>
                <option value="8">Tuyên Quang</option>
                <option value="10">Lào Cai</option>
                <option value="11">Điện Biên</option>
                <option value="12">Lai Châu</option>
                <option value="14">Sơn La</option>
                <option value="15">Yên Bái</option>
                <option value="17">Hòa Bình</option>
                <option value="19">Thái Nguyên</option>
                <option value="20">Lạng Sơn</option>
                <option value="22">Quảng Ninh</option>
                <option value="24">Bắc Giang</option>
                <option value="25">Phú Thọ</option>
                <option value="26">Vĩnh Phúc</option>
                <option value="27">Bắc Ninh</option>
                <option value="30">Hải Dương</option>
                <option value="31">Hải Phòng</option>
                <option value="33">Hưng Yên</option>
                <option value="34">Thái Bình</option>
                <option value="35">Hà Nam</option>
                <option value="36">Nam Định</option>
                <option value="37">Ninh Bình</option>
                <option value="38">Thanh Hóa</option>
                <option value="40">Nghệ An</option>
                <option value="42">Hà Tĩnh</option>
                <option value="44">Quảng Bình</option>
                <option value="45">Quảng Trị</option>
                <option value="46">Thừa Thiên Huế</option>
                <option value="48">Đà Nẵng</option>
                <option value="49">Quảng Nam</option>
                <option value="51">Quảng Ngãi</option>
                <option value="52">Bình Định</option>
                <option value="54">Phú Yên</option>
                <option value="56">Khánh Hòa</option>
                <option value="58">Ninh Thuận</option>
                <option value="60">Bình Thuận</option>
                <option value="62">Kon Tum</option>
                <option value="64">Gia Lai</option>
                <option value="66">Đắk Lắk</option>
                <option value="67">Đắk Nông</option>
                <option value="68">Lâm Đồng</option>
                <option value="70">Bình Phước</option>
                <option value="72">Tây Ninh</option>
                <option value="74">Bình Dương</option>
                <option value="75">Đồng Nai</option>
                <option value="77">Bà Rịa - Vũng Tàu</option>
                <option value="79">Hồ Chí Minh</option>
                <option value="80">Long An</option>
                <option value="82">Tiền Giang</option>
                <option value="83">Bến Tre</option>
                <option value="84">Trà Vinh</option>
                <option value="86">Vĩnh Long</option>
                <option value="87">Đồng Tháp</option>
                <option value="89">An Giang</option>
                <option value="91">Kiên Giang</option>
                <option value="92">Cần Thơ</option>
                <option value="93">Hậu Giang</option>
                <option value="94">Sóc Trăng</option>
                <option value="95">Bạc Liêu</option>
                <option value="96">Cà Mau</option>
            </select>
            <button type="submit" class="button">
                <span class="label">Tra cứu</span>
            </button>
        </form>
        <div id="progressContainer" style="display:none;">
            <p>Đang xử lý...</p>
            <progress id="progressBar" value="0" max="100"></progress>
        </div>
        <div id="result">
            <canvas id="myChart"></canvas>
            <button id="captureButton" class="button" style="display: none;">
                <span class="label">Chụp ảnh</span>
                <i class="fas fa-camera svg-icon"></i>
            </button>
        </div>
    </div>
    <div id="gioi-thieu" class="container">
        <h3>Giới thiệu</h3>
        <p>Chào mừng bạn đến với trang web tra cứu điểm thi THPTQG 2024. Trang web này được mình thiết kế để giúp bạn dễ dàng tra cứu điểm thi của mình một cách nhanh chóng và chính xác với giao diện hoàn toàn khác.</p>
    </div>
    <div id="lien-he" class="container">
        <h3>Thông tin liên hệ</h3>
        <div class="contact-card">
            <p><strong>Lê Anh Tuấn</strong></p>
            <p>Email: <a"mailto:leanhtuan.coder@gmail.com">leanhtuan.coder@gmail.com</a></p>
        </div>
    </div>

    <footer class="footer">
        <p>&copy; Copyright © 2024 | Le Anh Tuan. All rights reserved </p>
    </footer>

    <script>
        document.getElementById('searchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            var soBaoDanh = document.getElementById('soBaoDanh').value;
            var province = document.getElementById('province').value;
            fetch('/search?soBaoDanh=' + soBaoDanh + '&province=' + province)
                .then(response => response.json())
                .then(data => {
                    var resultDiv = document.getElementById('result');
                    resultDiv.innerHTML = '<canvas id="myChart"></canvas><button id="captureButton" class="button" style="display: none;"><span class="label">Chụp ảnh</span><i class="fas fa-camera svg-icon"></i></button>'; // Clear previous results and add canvas and button

                    var result = data.result;
                    if (Array.isArray(result)) {
                        var labels = result.map(item => item[0]);
                        var scores = result.map(item => parseFloat(item[1]));

                        var ctx = document.getElementById('myChart').getContext('2d');
                        var chart = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'Điểm thi',
                                    data: [],
                                    backgroundColor: 'rgba(40, 167, 69, 0.6)',
                                    borderColor: 'rgba(40, 167, 69, 1)',
                                    borderWidth: 1,
                                    hoverBackgroundColor: 'rgba(40, 167, 69, 0.8)',
                                    hoverBorderColor: 'rgba(40, 167, 69, 1)'
                                }]
                            },
                            options: {
                                plugins: {
                                    datalabels: {
                                        anchor: 'end',
                                        align: 'end',
                                        color: '#444',
                                        font: {
                                            weight: 'bold'
                                        },
                                        formatter: function(value) {
                                            return value.toFixed(2);
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        max: 10
                                    }
                                }
                            },
                            plugins: [ChartDataLabels]
                        });

                        var i = 0;
                        function addData() {
                            if (i < scores.length) {
                                chart.data.datasets[0].data.push(scores[i]);
                                chart.update();
                                i++;
                                setTimeout(addData, 500); // Tăng khoảng thời gian nếu muốn chậm hơn
                            } else {
                                var captureButton = document.getElementById('captureButton');
                                captureButton.style.display = 'flex'; // Hiển thị nút chụp ảnh

                                captureButton.addEventListener('click', function() {
                                    captureButton.style.display = 'none'; // Ẩn nút chụp ảnh trước khi chụp
                                    html2canvas(resultDiv).then(function(canvas) {
                                        var link = document.createElement('a');
                                        link.download = 'ket-qua-tra-cuu.png';
                                        link.href = canvas.toDataURL();
                                        link.click();
                                        captureButton.style.display = 'flex'; // Hiển thị lại nút chụp ảnh sau khi chụp
                                    });
                                });
                            }
                        }
                        addData();
                    } else {
                        resultDiv.textContent = result;
                    }
                });
        });

        function updateProgress(percent) {
            var progressBar = document.getElementById('progressBar');
            progressBar.value = percent;
        }

        function showProgress() {
            var progressContainer = document.getElementById('progressContainer');
            progressContainer.style.display = 'block';
        }

        function hideProgress() {
            var progressContainer = document.getElementById('progressContainer');
            progressContainer.style.display = 'none';
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
</body>
</html>
